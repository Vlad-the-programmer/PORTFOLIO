{% extends '../base.html' %} 

    {% block scripts %}
    <!-- Function to toggle like -->
    <script>
      function handleLikeClick(x) {
        console.log(x.classList[1])
        if(x.classList[1] == "fa-thumbs-up"){
          x.classList.toggle("fa-thumbs-down");
        } else {
          x.classList.toggle("fa-thumbs-up");
        }
        x.addEventListener('click', (e) => {
          createRemoveLikeRequest();
        })
      }

      async function createRemoveLikeRequest(){
        console.log(`{{post.slug}}`);
        try {
          const response = await fetch(
            "{% url 'likes:like-create-delete' post_slug=post.slug %}",
            {
              headers: {
                "X-CSRFToken": '{{ csrf_token }}',
                "Content-Type": "application/json",
              },
              method: "POST", 
              body: "",
            });

        } catch(e){
          console.error("Error:", e);
        }
      }
    </script>
    {% endblock %} 

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-8 card mb-4 mt-3 left top">
      <div class="card-body">
        {% for tag in post.tags.all %}
        <a href="#" class="badge text-decoration-none bg-secondary">
          {{tag}}
        </a>
        {% endfor %}
        <h1>{% block title %} {{ post.title }} {% endblock title %}</h1>
        {% comment %} <p class="text-muted">{{ post.author.username }} | {{ post.created_at }}</p> {% endcomment %}
        <a href="{% url 'users:following-user-profile' username=post.author.username %}" 
        class="btn btn-danger">{{ post.author.username }} | {{ post.created_at }}
        </a>
        <p class="card-text">{{ post.content | safe }}</p>
         {% if profile.email == post.author.email %} 
        <li class="btn btn-danger">
          <a
            href="{% url 'posts:post-delete' slug=post.slug %}"
            class="btn btn--sub"
            >Delete</a
          >
        </li>
        <li class="btn btn-info">
          <a
            href="{% url 'posts:post-update' slug=post.slug %}"
            class="btn btn--sub"
            >Update</a
          >
        </li>
        {% endif %}
        <!-- Use an element to toggle between a like/dislike icon -->
        <form method='POST' action="">
          {% csrf_token %} 
          {% comment %} {{ form }} {% endcomment %}
          <a
          name="like"
          id="like"
          class="btn btn-primary"
          role="button"
          >
          <i onclick="handleLikeClick(this)" id="#thumb-up" class="fa fa-thumbs-up"></i>
        </a>
        <p>{{post_likes}}</p>
      </form>
      </div>
    </div>
    {% block sidebar %} 
        {% include 'partials/sidebar.html' %}
    {% endblock sidebar %}
  </div>
</div>
{% include 'partials/comments_list.html' with form=comment_form post=post page_obj=page_obj comments=comments %} 

{% include 'partials/paginate-page-navigation.html' with page_obj=page_obj custom_range=custom_range %} 

{% endblock content %}
